<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trang cÃ¡ nhÃ¢n - Miu</title>
  
  <!-- âœ… LIFF SDK ã‚’ç›´æ¥èª­ã¿è¾¼ã‚€ -->
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #ffffff;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      border: 1px solid #f0f0f0;
    }

    .header {
      background: linear-gradient(135deg, #fab536 0%, #ff8c42 100%);
      color: white;
      padding: 40px 24px 30px;
      text-align: center;
      position: relative;
    }

    .miu-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 16px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .header p {
      font-size: 15px;
      opacity: 0.95;
      font-weight: 500;
    }

    .content {
      padding: 30px 24px 40px;
    }

    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
    .progress-section {
      background: linear-gradient(135deg, #FFF9F0 0%, #FFF5E8 100%);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 28px;
      border: 2px solid #FEE8C0;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .progress-title {
      font-size: 17px;
      font-weight: 700;
      color: #fab536;
    }

    .progress-percentage {
      font-size: 24px;
      font-weight: 800;
      color: #fab536;
    }

    .progress-bar-container {
      width: 100%;
      height: 12px;
      background: white;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 12px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #fab536 0%, #ff8c42 100%);
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.3) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-message {
      font-size: 14px;
      color: #d68a1f;
      margin-top: 10px;
      font-weight: 600;
      line-height: 1.5;
    }

    .missing-items {
      margin-top: 16px;
      padding: 16px;
      background: white;
      border-left: 4px solid #fab536;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .missing-items-title {
      font-size: 14px;
      font-weight: 700;
      color: #fab536;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .missing-items-list {
      font-size: 13px;
      color: #666;
      line-height: 1.8;
    }

    /* åˆ©ç”¨çŠ¶æ³ */
    .stats {
      background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 28px;
      border: 2px solid #BAE6FD;
    }

    .stats h3 {
      font-size: 17px;
      margin-bottom: 18px;
      color: #0369A1;
      font-weight: 700;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding: 10px 0;
      border-bottom: 1px solid #BAE6FD;
    }

    .stat-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .stat-label {
      color: #0369A1;
      font-size: 14px;
      font-weight: 600;
    }

    .stat-value {
      font-weight: 700;
      color: #0C4A6E;
      font-size: 16px;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ  */
    .form-group {
      margin-bottom: 28px;
    }

    label {
      display: block;
      font-weight: 700;
      margin-bottom: 10px;
      color: #1F2937;
      font-size: 15px;
    }

    .label-main {
      font-size: 16px;
      color: #111827;
    }

    .label-sub {
      font-size: 13px;
      color: #6B7280;
      font-weight: 500;
      margin-left: 6px;
    }

    .required {
      color: #fab536;
      margin-left: 4px;
      font-size: 18px;
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s;
      background: white;
      font-family: inherit;
    }

    input[type="text"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #fab536;
      box-shadow: 0 0 0 4px rgba(250, 181, 54, 0.15);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      line-height: 1.5;
    }

    .input-hint {
      font-size: 12px;
      color: #9CA3AF;
      margin-top: 6px;
      font-style: italic;
    }

    .hidden {
      display: none;
    }

    .language-toggle {
      display: flex;
      gap: 12px;
      margin-top: 10px;
    }

    .language-toggle label {
      flex: 1;
      padding: 14px;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      font-size: 15px;
    }

    .language-toggle input[type="radio"] {
      display: none;
    }

    .language-toggle input[type="radio"]:checked + label {
      background: linear-gradient(135deg, #fab536 0%, #ff8c42 100%);
      color: white;
      border-color: #fab536;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(250, 181, 54, 0.4);
    }

    .save-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #fab536 0%, #ff8c42 100%);
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 8px 24px rgba(250, 181, 54, 0.4);
      position: relative;
      overflow: hidden;
    }

    .save-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
      );
      transition: left 0.5s;
    }

    .save-btn:hover::before {
      left: 100%;
    }

    .save-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 32px rgba(250, 181, 54, 0.5);
    }

    .save-btn:active {
      transform: translateY(-1px);
    }

    .save-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: white;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 24px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading p {
      font-size: 16px;
      font-weight: 600;
    }

    .error {
      background: #FEE2E2;
      color: #991B1B;
      padding: 16px 18px;
      border-radius: 12px;
      margin-bottom: 24px;
      font-size: 14px;
      border-left: 4px solid #DC2626;
      font-weight: 600;
    }

    .success {
      background: #D1FAE5;
      color: #065F46;
      padding: 16px 18px;
      border-radius: 12px;
      margin-bottom: 24px;
      font-size: 14px;
      border-left: 4px solid #10B981;
      font-weight: 600;
    }

    .miu-message {
      background: linear-gradient(135deg, #FFF9F0 0%, #FFF5E8 100%);
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 28px;
      border: 2px solid #FEE8C0;
      position: relative;
      padding-left: 70px;
    }

    .miu-message::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 15px;
      width: 45px;
      height: 45px;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23fab536"/><circle cx="35" cy="40" r="8" fill="white"/><circle cx="65" cy="40" r="8" fill="white"/><circle cx="35" cy="40" r="4" fill="black"/><circle cx="65" cy="40" r="4" fill="black"/><path d="M 30 55 Q 50 65 70 55" stroke="black" stroke-width="2" fill="none"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
    }

    .miu-message p {
      font-size: 14px;
      color: #d68a1f;
      line-height: 1.7;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==" 
           alt="Miu" 
           class="miu-icon"
           style="display: none;">
      <!-- â†‘ å®Ÿéš›ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã«å·®ã—æ›¿ãˆã¦ãã ã•ã„ -->
      <div style="font-size: 64px; margin-bottom: 10px;">ğŸ±</div>
      <h1>ğŸ± Trang cÃ¡ nhÃ¢n cá»§a báº¡n</h1>
      <p>ãƒã‚¤ãƒšãƒ¼ã‚¸</p>
    </div>

    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Äang táº£i...<br>ã‚ˆã¿ã“ã¿ä¸­...</p>
    </div>

    <div id="content" class="content hidden">
      <div id="errorMessage" class="error hidden"></div>
      <div id="successMessage" class="success hidden"></div>

      <!-- Miuã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div class="miu-message">
        <p>
          <strong>Xin chÃ o! ğŸ’š Miu Ä‘Ã¢y!</strong><br>
          ã“ã‚“ã«ã¡ã¯ï¼Miuã ã‚ˆï¼<br><br>
          HÃ£y cho Miu biáº¿t thÃªm vá» báº¡n nhÃ©! Äiá»n khi nÃ o muá»‘n, khÃ´ng vá»™i Ä‘Ã¢u ğŸ˜Š<br>
          <span style="font-size: 13px;">ã‚ãªãŸã®ã“ã¨ã‚’ãŠã—ãˆã¦ï¼ã„ããŒãªãã¦ã„ã„ã‚ˆğŸ˜Š</span>
        </p>
      </div>

      <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«é€²è¡Œåº¦ -->
      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-title">ğŸ“ Má»©c Ä‘á»™ hoÃ n thÃ nh</span>
          <span class="progress-percentage" id="progressPercentage">0%</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <p class="progress-message" id="progressMessage">HÃ£y Ä‘iá»n thÃ´ng tin Ä‘á»ƒ Miu hiá»ƒu báº¡n hÆ¡n!</p>
        
        <div class="missing-items hidden" id="missingItems">
          <div class="missing-items-title">
            <span>ğŸ’¡</span>
            <span>CÃ²n cÃ³ thá»ƒ Ä‘iá»n thÃªm / ã¾ã ã„ã‚Œã‚‰ã‚Œã‚‹ã‚ˆ:</span>
          </div>
          <div class="missing-items-list" id="missingItemsList"></div>
        </div>
      </div>

      <!-- åˆ©ç”¨çŠ¶æ³ -->
      <div class="stats">
        <h3>ğŸ“Š TÃ¬nh tráº¡ng sá»­ dá»¥ng / ã¤ã‹ã£ãŸã‹ã„ã™ã†</h3>
        <div class="stat-item">
          <span class="stat-label">HÃ´m nay / ãã‚‡ã†:</span>
          <span class="stat-value" id="usageCount">-</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">GÃ³i / ãƒ—ãƒ©ãƒ³:</span>
          <span class="stat-value" id="plan">-</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Tá»•ng cá»™ng / ãœã‚“ã¶:</span>
          <span class="stat-value" id="totalUsage">-</span>
        </div>
      </div>

      <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ•ã‚©ãƒ¼ãƒ  -->
      <form id="profileForm">
        <!-- åå‰ï¼ˆè‡ªç”±è¨˜å…¥ï¼‰ -->
        <div class="form-group">
          <label>
            <span class="label-main">TÃªn báº¡n muá»‘n Miu gá»i</span>
            <br>
            <span class="label-sub">Miuã«ã‚ˆã‚“ã§ã»ã—ã„ãªã¾ãˆ</span>
          </label>
          <input type="text" id="name" placeholder="VÃ­ dá»¥: Linh, Anh Tuáº¥n, ãƒªãƒ³ã¡ã‚ƒã‚“...">
          <div class="input-hint">ğŸ’¡ CÃ³ thá»ƒ lÃ  tÃªn tiáº¿ng Viá»‡t, tiáº¿ng Nháº­t, hoáº·c biá»‡t danh!</div>
        </div>

        <!-- Miuã«èª­ã‚“ã§ã»ã—ã„åå‰ï¼ˆãµã‚ŠãŒãªï¼‰ -->
        <div class="form-group">
          <label>
            <span class="label-main">CÃ¡ch Ä‘á»c tÃªn (báº±ng Hiragana)</span>
            <br>
            <span class="label-sub">ãªã¾ãˆã®ã‚ˆã¿ã‹ãŸï¼ˆã²ã‚‰ãŒãªï¼‰</span>
          </label>
          <input type="text" id="nameReading" placeholder="VÃ­ dá»¥: ã‚Šã‚“ã€ã‚ã‚“ã¨ã…ã‚ã‚“...">
          <div class="input-hint">ğŸ“¢ Äá»ƒ Miu cÃ³ thá»ƒ Ä‘á»c tÃªn báº¡n Ä‘Ãºng cÃ¡ch nháº¥t!</div>
        </div>

        <!-- æ—¥æœ¬èªãƒ¬ãƒ™ãƒ« -->
        <div class="form-group">
          <label>
            <span class="label-main">TrÃ¬nh Ä‘á»™ tiáº¿ng Nháº­t</span>
            <br>
            <span class="label-sub">ã«ã»ã‚“ã”ãƒ¬ãƒ™ãƒ«</span>
          </label>
          <select id="japaneseLevel">
            <option value="">Chá»n / ãˆã‚‰ã‚“ã§</option>
            <option value="N5">N5 (SÆ¡ cáº¥p / ã—ã‚‡ãã‚…ã†)</option>
            <option value="N4">N4 (SÆ¡ - Trung cáº¥p / ã—ã‚‡ã¡ã‚…ã†ãã‚…ã†)</option>
            <option value="N3">N3 (Trung cáº¥p / ã¡ã‚…ã†ãã‚…ã†)</option>
            <option value="N2">N2 (Trung - Cao cáº¥p / ã¡ã‚…ã†ã“ã†ãã‚…ã†)</option>
            <option value="N1">N1 (Cao cáº¥p / ã“ã†ãã‚…ã†)</option>
            <option value="ãªã—">ChÆ°a cÃ³ / ã¾ã ãªã„</option>
          </select>
        </div>

        <!-- åœ¨ç•™è³‡æ ¼ -->
        <div class="form-group">
          <label>
            <span class="label-main">TÆ° cÃ¡ch lÆ°u trÃº</span>
            <br>
            <span class="label-sub">ã–ã„ã‚Šã‚…ã†ã—ã‹ã</span>
          </label>
          <select id="residenceStatus">
            <option value="">Chá»n / ãˆã‚‰ã‚“ã§</option>
            <option value="æŠ€èƒ½å®Ÿç¿’">Thá»±c táº­p ká»¹ nÄƒng / ãã®ã†ã˜ã£ã—ã‚…ã†</option>
            <option value="ç‰¹å®šæŠ€èƒ½">Ká»¹ nÄƒng Ä‘áº·c Ä‘á»‹nh / ã¨ãã¦ã„ãã®ã†</option>
            <option value="ç•™å­¦">Du há»c / ã‚Šã‚…ã†ãŒã</option>
            <option value="å®¶æ—æ»åœ¨">Gia Ä‘Ã¬nh lÆ°u trÃº / ã‹ãããŸã„ã–ã„</option>
            <option value="æ°¸ä½è€…">ThÆ°á»ng trÃº / ãˆã„ã˜ã‚…ã†ã—ã‚ƒ</option>
            <option value="å®šä½è€…">Äá»‹nh cÆ° / ã¦ã„ã˜ã‚…ã†ã—ã‚ƒ</option>
            <option value="æ—¥æœ¬äººã®é…å¶è€…ç­‰">Vá»£/chá»“ng ngÆ°á»i Nháº­t / ã«ã»ã‚“ã˜ã‚“ã®ã¯ã„ãã†ã—ã‚ƒã¨ã†</option>
            <option value="æ°¸ä½è€…ã®é…å¶è€…ç­‰">Vá»£/chá»“ng thÆ°á»ng trÃº / ãˆã„ã˜ã‚…ã†ã—ã‚ƒã®ã¯ã„ãã†ã—ã‚ƒã¨ã†</option>
            <option value="æŠ€è¡“ãƒ»äººæ–‡çŸ¥è­˜ãƒ»å›½éš›æ¥­å‹™">Ká»¹ thuáº­t/Kiáº¿n thá»©c / ãã˜ã‚…ã¤ãƒ»ã˜ã‚“ã¶ã‚“ã¡ã—ã</option>
            <option value="ãã®ä»–">KhÃ¡c / ãã®ä»–</option>
          </select>
        </div>

        <!-- ãã®ä»–ã®åœ¨ç•™è³‡æ ¼ -->
        <div class="form-group hidden" id="otherResidenceGroup">
          <label>
            <span class="label-main">Chi tiáº¿t tÆ° cÃ¡ch lÆ°u trÃº</span>
            <br>
            <span class="label-sub">ãã‚ã—ã„ã–ã„ã‚Šã‚…ã†ã—ã‹ã</span>
          </label>
          <input type="text" id="otherResidence" placeholder="VÃ­ dá»¥: æŠ€èƒ½ (Ká»¹ nÄƒng)...">
        </div>

        <!-- éƒ½é“åºœçœŒ -->
        <div class="form-group">
          <label>
            <span class="label-main">Tá»‰nh thÃ nh Ä‘ang sá»‘ng</span>
            <br>
            <span class="label-sub">ã™ã‚“ã§ã„ã‚‹ã¨ã“ã‚</span>
          </label>
          <select id="prefecture">
            <option value="">Chá»n / ãˆã‚‰ã‚“ã§</option>
            <option value="åŒ—æµ·é“">Hokkaido / ã»ã£ã‹ã„ã©ã†</option>
            <option value="é’æ£®çœŒ">Aomori / ã‚ãŠã‚‚ã‚Š</option>
            <option value="å²©æ‰‹çœŒ">Iwate / ã„ã‚ã¦</option>
            <option value="å®®åŸçœŒ">Miyagi / ã¿ã‚„ã</option>
            <option value="ç§‹ç”°çœŒ">Akita / ã‚ããŸ</option>
            <option value="å±±å½¢çœŒ">Yamagata / ã‚„ã¾ãŒãŸ</option>
            <option value="ç¦å³¶çœŒ">Fukushima / ãµãã—ã¾</option>
            <option value="èŒ¨åŸçœŒ">Ibaraki / ã„ã°ã‚‰ã</option>
            <option value="æ ƒæœ¨çœŒ">Tochigi / ã¨ã¡ã</option>
            <option value="ç¾¤é¦¬çœŒ">Gunma / ãã‚“ã¾</option>
            <option value="åŸ¼ç‰çœŒ">Saitama / ã•ã„ãŸã¾</option>
            <option value="åƒè‘‰çœŒ">Chiba / ã¡ã°</option>
            <option value="æ±äº¬éƒ½">Tokyo / ã¨ã†ãã‚‡ã†</option>
            <option value="ç¥å¥ˆå·çœŒ">Kanagawa / ã‹ãªãŒã‚</option>
            <option value="æ–°æ½ŸçœŒ">Niigata / ã«ã„ãŒãŸ</option>
            <option value="å¯Œå±±çœŒ">Toyama / ã¨ã‚„ã¾</option>
            <option value="çŸ³å·çœŒ">Ishikawa / ã„ã—ã‹ã‚</option>
            <option value="ç¦äº•çœŒ">Fukui / ãµãã„</option>
            <option value="å±±æ¢¨çœŒ">Yamanashi / ã‚„ã¾ãªã—</option>
            <option value="é•·é‡çœŒ">Nagano / ãªãŒã®</option>
            <option value="å²é˜œçœŒ">Gifu / ããµ</option>
            <option value="é™å²¡çœŒ">Shizuoka / ã—ãšãŠã‹</option>
            <option value="æ„›çŸ¥çœŒ">Aichi / ã‚ã„ã¡</option>
            <option value="ä¸‰é‡çœŒ">Mie / ã¿ãˆ</option>
            <option value="æ»‹è³€çœŒ">Shiga / ã—ãŒ</option>
            <option value="äº¬éƒ½åºœ">Kyoto / ãã‚‡ã†ã¨</option>
            <option value="å¤§é˜ªåºœ">Osaka / ãŠãŠã•ã‹</option>
            <option value="å…µåº«çœŒ">Hyogo / ã²ã‚‡ã†ã”</option>
            <option value="å¥ˆè‰¯çœŒ">Nara / ãªã‚‰</option>
            <option value="å’Œæ­Œå±±çœŒ">Wakayama / ã‚ã‹ã‚„ã¾</option>
            <option value="é³¥å–çœŒ">Tottori / ã¨ã£ã¨ã‚Š</option>
            <option value="å³¶æ ¹çœŒ">Shimane / ã—ã¾ã­</option>
            <option value="å²¡å±±çœŒ">Okayama / ãŠã‹ã‚„ã¾</option>
            <option value="åºƒå³¶çœŒ">Hiroshima / ã²ã‚ã—ã¾</option>
            <option value="å±±å£çœŒ">Yamaguchi / ã‚„ã¾ãã¡</option>
            <option value="å¾³å³¶çœŒ">Tokushima / ã¨ãã—ã¾</option>
            <option value="é¦™å·çœŒ">Kagawa / ã‹ãŒã‚</option>
            <option value="æ„›åª›çœŒ">Ehime / ãˆã²ã‚</option>
            <option value="é«˜çŸ¥çœŒ">Kochi / ã“ã†ã¡</option>
            <option value="ç¦å²¡çœŒ">Fukuoka / ãµããŠã‹</option>
            <option value="ä½è³€çœŒ">Saga / ã•ãŒ</option>
            <option value="é•·å´çœŒ">Nagasaki / ãªãŒã•ã</option>
            <option value="ç†Šæœ¬çœŒ">Kumamoto / ãã¾ã‚‚ã¨</option>
            <option value="å¤§åˆ†çœŒ">Oita / ãŠãŠã„ãŸ</option>
            <option value="å®®å´çœŒ">Miyazaki / ã¿ã‚„ã–ã</option>
            <option value="é¹¿å…å³¶çœŒ">Kagoshima / ã‹ã”ã—ã¾</option>
            <option value="æ²–ç¸„çœŒ">Okinawa / ãŠããªã‚</option>
          </select>
        </div>

        <!-- è¨€èªè¨­å®š -->
        <div class="form-group">
          <label>
            <span class="label-main">NgÃ´n ngá»¯ hiá»ƒn thá»‹</span>
            <br>
            <span class="label-sub">ã²ã‚‡ã†ã˜ã™ã‚‹ã’ã‚“ã”</span>
          </label>
          <div class="language-toggle">
            <input type="radio" name="language" value="vi" id="langVi" checked>
            <label for="langVi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</label>
            
            <input type="radio" name="language" value="ja" id="langJa">
            <label for="langJa">ğŸ‡¯ğŸ‡µ ã‚„ã•ã—ã„æ—¥æœ¬èª</label>
          </div>
          <div class="input-hint">ğŸ’¡ Miu sáº½ tráº£ lá»i báº±ng ngÃ´n ngá»¯ báº¡n chá»n!</div>
        </div>

        <button type="submit" class="save-btn" id="saveBtn">
          ğŸ’š Äá»ƒ Miu nhá»› / Miuã«ãŠã¼ãˆã¦ã‚‚ã‚‰ã†
        </button>
      </form>
    </div>
  </div>

  <script>

    const LIFF_ID = '2008551240-lQ0qWLdx';
    let userId = null;

    // LIFFåˆæœŸåŒ–
    async function initializeLiff() {
      try {
        console.log('Initializing LIFF...');
        
        await liff.init({ liffId: LIFF_ID });
        
        console.log('LIFF initialized, checking login status...');
        
        if (!liff.isLoggedIn()) {
          console.log('Not logged in, redirecting to login...');
          liff.login();
          return;
        }

        console.log('Logged in, getting profile...');
        const profile = await liff.getProfile();
        userId = profile.userId;
        console.log('User ID:', userId);

        await loadProfile();

        document.getElementById('loading').classList.add('hidden');
        document.getElementById('content').classList.remove('hidden');

      } catch (error) {
        console.error('LIFF initialization failed', error);
        showError('Khá»Ÿi táº¡o tháº¥t báº¡i / ã—ã‚‡ãã‹ã«ã—ã£ã±ã„ã—ã¾ã—ãŸ: ' + error.message);
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('content').classList.remove('hidden');
      }
    }

    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—
    async function loadProfile() {
      try {
        const response = await fetch(`/api/get-profile?userId=${userId}`);
        const data = await response.json();

        if (data.success) {
          const user = data.user;
          
          document.getElementById('name').value = user.preferred_name || '';
          document.getElementById('nameReading').value = user.name_reading || '';
          document.getElementById('japaneseLevel').value = user.japanese_level || '';
          document.getElementById('prefecture').value = user.prefecture || '';
          
          // åœ¨ç•™è³‡æ ¼
          if (user.residence_status) {
            const options = Array.from(document.getElementById('residenceStatus').options);
            const matchedOption = options.find(opt => opt.value === user.residence_status);
            
            if (matchedOption) {
              document.getElementById('residenceStatus').value = user.residence_status;
            } else {
              document.getElementById('residenceStatus').value = 'ãã®ä»–';
              document.getElementById('otherResidence').value = user.residence_status;
              document.getElementById('otherResidenceGroup').classList.remove('hidden');
            }
          }

          const language = user.language || 'vi';
          document.getElementById(language === 'ja' ? 'langJa' : 'langVi').checked = true;

          // åˆ©ç”¨çŠ¶æ³
          const limit = user.plan === 'premium' ? 'âˆ' : '10';
          document.getElementById('usageCount').textContent = `${user.today_count || 0}/${limit} láº§n`;
          document.getElementById('plan').textContent = user.plan === 'premium' ? 'Premium ğŸ’' : 'Free ğŸ†“';
          document.getElementById('totalUsage').textContent = `${user.total_usage_count || 0} láº§n`;

          // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
          setTimeout(updateProgress, 100);
        }
      } catch (error) {
        console.error('Failed to load profile', error);
        showError('Táº£i dá»¯ liá»‡u tháº¥t báº¡i / ãƒ‡ãƒ¼ã‚¿ã®ã‚ˆã¿ã“ã¿ã«ã—ã£ã±ã„ã—ã¾ã—ãŸ');
      }
    }

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
    function updateProgress() {
      const fields = {
        'TÃªn / ãªã¾ãˆ': document.getElementById('name').value.trim(),
        'TrÃ¬nh Ä‘á»™ / ãƒ¬ãƒ™ãƒ«': document.getElementById('japaneseLevel').value,
        'TÆ° cÃ¡ch / ã—ã‹ã': document.getElementById('residenceStatus').value,
        'Tá»‰nh thÃ nh / ã¨ã“ã‚': document.getElementById('prefecture').value,
      };

      if (fields['TÆ° cÃ¡ch / ã—ã‹ã'] === 'ãã®ä»–') {
        fields['Chi tiáº¿t / ãã‚ã—ã'] = document.getElementById('otherResidence').value.trim();
        delete fields['TÆ° cÃ¡ch / ã—ã‹ã'];
      }

      const totalFields = Object.keys(fields).length;
      const filledFields = Object.values(fields).filter(val => val !== '').length;
      const percentage = Math.round((filledFields / totalFields) * 100);

      document.getElementById('progressBar').style.width = percentage + '%';
      document.getElementById('progressPercentage').textContent = percentage + '%';

      let message = '';
      if (percentage === 100) {
        message = 'ğŸ‰ HoÃ n thÃ nh! Miu Ä‘Ã£ nhá»› háº¿t rá»“i! / ã‹ã‚“ã›ã„ï¼Miuãœã‚“ã¶ãŠã¼ãˆãŸã‚ˆï¼';
        document.getElementById('missingItems').classList.add('hidden');
      } else if (percentage >= 75) {
        message = 'ğŸ’ª Sáº¯p xong rá»“i! / ã‚‚ã†ã™ã“ã—ï¼';
      } else if (percentage >= 50) {
        message = 'ğŸ“ ÄÃ£ Ä‘Æ°á»£c ná»­a rá»“i! / ã¯ã‚“ã¶ã‚“ã§ããŸï¼';
      } else if (percentage > 0) {
        message = 'âœï¸ Cá»© tá»« tá»« Ä‘iá»n nhÃ©! / ã‚†ã£ãã‚Šã„ã‚Œã¦ã­ï¼';
      } else {
        message = 'ğŸ“ Äiá»n khi nÃ o báº¡n muá»‘n! / ã™ããªã¨ãã«ã„ã‚Œã¦ã­ï¼';
      }
      document.getElementById('progressMessage').textContent = message;

      if (percentage < 100) {
        const missingFields = Object.entries(fields)
          .filter(([key, value]) => value === '')
          .map(([key]) => key);

        if (missingFields.length > 0) {
          document.getElementById('missingItemsList').innerHTML = 
            missingFields.map(field => `ãƒ»${field}`).join('<br>');
          document.getElementById('missingItems').classList.remove('hidden');
        }
      }
    }

    // ãã®ä»–ã®åœ¨ç•™è³‡æ ¼
    document.getElementById('residenceStatus').addEventListener('change', function(e) {
      const otherGroup = document.getElementById('otherResidenceGroup');
      if (e.target.value === 'ãã®ä»–') {
        otherGroup.classList.remove('hidden');
      } else {
        otherGroup.classList.add('hidden');
      }
      updateProgress();
    });

    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
    document.getElementById('profileForm').addEventListener('input', updateProgress);

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    document.getElementById('profileForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const saveBtn = document.getElementById('saveBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'ğŸ’­ Miu Ä‘ang nhá»›... / ãŠã¼ãˆã¦ã‚‹...';

      const residenceStatus = document.getElementById('residenceStatus').value;
      const otherResidence = document.getElementById('otherResidence').value;

      const formData = {
        userId: userId,
        preferred_name: document.getElementById('name').value.trim(),
        name_reading: document.getElementById('nameReading').value.trim(),
        japanese_level: document.getElementById('japaneseLevel').value,
        residence_status: residenceStatus === 'ãã®ä»–' ? otherResidence.trim() : residenceStatus,
        prefecture: document.getElementById('prefecture').value,
        language: document.querySelector('input[name="language"]:checked').value,
      };

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‰Šé™¤ï¼šç©ºã§ã‚‚ä¿å­˜å¯èƒ½

      try {
        const response = await fetch('/api/update-profile', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData),
        });

        const result = await response.json();

        if (result.success) {
          showSuccess('ğŸ’š Miu Ä‘Ã£ nhá»› rá»“i! / ãŠã¼ãˆãŸã‚ˆï¼');
          
          setTimeout(() => {
            liff.closeWindow();
          }, 1500);
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        console.error('Failed to save profile', error);
        showError('LÆ°u tháº¥t báº¡i / ã»ãã‚“ã«ã—ã£ã±ã„ã—ã¾ã—ãŸ: ' + error.message);
        saveBtn.disabled = false;
        saveBtn.textContent = 'ğŸ’š Äá»ƒ Miu nhá»› / Miuã«ãŠã¼ãˆã¦ã‚‚ã‚‰ã†';
      }
    });

    function showError(message) {
      const errorEl = document.getElementById('errorMessage');
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
      setTimeout(() => errorEl.classList.add('hidden'), 5000);
    }

    function showSuccess(message) {
      const successEl = document.getElementById('successMessage');
      successEl.textContent = message;
      successEl.classList.remove('hidden');
    }

    // ãƒ¡ã‚¤ãƒ³å‡¦ç†ï¼šLIFF SDKã‚’èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰åˆæœŸåŒ–
    async function main() {
  try {
    console.log('ğŸš€ Starting LIFF initialization...');
    await initializeLiff();
  } catch (error) {
    console.error('âŒ Main error:', error);
    showError('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ / Lá»—i khá»Ÿi táº¡o: ' + error.message);
    document.getElementById('loading').classList.add('hidden');
    document.getElementById('content').classList.remove('hidden');
  }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œ
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', main);
} else {
  main();
}
  </script>
</body>
</html>